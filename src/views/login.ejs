<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Gendang Lombok</title>

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/login.css" />
    <style>
      .dark-toggle {
        position: absolute;
        top: 10px;
        right: 20px;
      }
    </style>
  </head>

  <body class="bg-light">
    <!-- Toggle Dark Mode -->
    <div class="dark-toggle">
      <button id="toggleDark" class="btn btn-outline-secondary btn-sm">
        <i class="fas fa-moon"></i>
      </button>
    </div>

    <main
      class="container d-flex justify-content-center align-items-center"
      style="min-height: 100vh"
    >
      <form
        action="/login/auth"
        method="POST"
        class="card shadow-lg p-4 border-0 col-md-5"
        id="loginCard"
      >
        <div class="text-center mb-3">
          <h2 class="fw-bold">Tenun Lombok Timur</h2>
        </div>

        <!-- Email -->
        <div class="mb-3 input-group">
          <span class="input-group-text bg-white">
            <i class="fas fa-envelope"></i>
          </span>
          <input
            type="email"
            id="email"
            name="email"
            class="form-control"
            placeholder="Masukkan email"
            required
          />
        </div>

        <!-- Password -->
        <div class="mb-4 input-group">
          <span class="input-group-text bg-white">
            <i class="fas fa-lock"></i>
          </span>
          <input
            type="password"
            id="password"
            name="password"
            class="form-control"
            placeholder="Masukkan password"
            required
          />
        </div>

        <!-- Tombol Login -->
        <div class="d-grid">
          <button type="submit" class="btn btn-success">
            <i class="fas fa-sign-in-alt me-2"></i> Login
          </button>
        </div>
        <br />

<% if (colorFlash && statusFlash && pesanFlash) { %>
  <div class="alert alert-<%= colorFlash %> alert-dismissible fade show" role="alert">
    <strong><%= statusFlash %>:</strong> <%= pesanFlash %>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>
<% } %>


<!-- script untuk notifikasi logout -->
<script>
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('logout') === '1') {
    Swal.fire({
      toast: true,
      position: 'top-end',
      icon: 'info',
      title: 'Kamu berhasil logout',
      showClass: {
        popup: 'swal2-show swal2-animate__slideOutDown'
      },
      hideClass: {
        popup: 'swal2-hide swal2-animate__slideInUp'
      },
      showConfirmButton: false,
      timer: 4000,
      timerProgressBar: true,
      didOpen: (toast) => {
        toast.addEventListener('mouseenter', Swal.stopTimer)
        toast.addEventListener('mouseleave', Swal.resumeTimer)
      },
      customClass: {
        popup: 'small-toast'
      }
    });

    // Hapus parameter logout agar tidak muncul saat reload
    const newUrl = window.location.origin + window.location.pathname;
    window.history.replaceState({}, document.title, newUrl);
  }
</script>

<style>

  .swal2-popup.small-toast {
    font-size: 0.9rem;
    padding: 0.75rem 1rem;
    min-width: 260px;
  }
</style>





    <!-- Dark Mode Script -->
    <script>
      const html = document.documentElement;
      const body = document.body;
      const card = document.getElementById("loginCard");
      const toggleBtn = document.getElementById("toggleDark");

      function setDarkMode(isDark) {
        html.setAttribute("data-bs-theme", isDark ? "dark" : "light");
        body.classList.toggle("dark-mode", isDark);
        card.classList.toggle("dark-mode", isDark);
        toggleBtn.innerHTML = isDark
          ? '<i class="fas fa-sun"></i>'
          : '<i class="fas fa-moon"></i>';
        localStorage.setItem("theme", isDark ? "dark" : "light");
      }

      // Load dark mode dari localStorage
      const savedTheme = localStorage.getItem("theme") || "light";
      setDarkMode(savedTheme === "dark");

      toggleBtn.addEventListener("click", () => {
        const isDark = html.getAttribute("data-bs-theme") !== "dark";
        setDarkMode(isDark);
      });
    </script>

    <!-- Bootstrap 5 JS (untuk tombol close alert) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
