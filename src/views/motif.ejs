<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard Motif</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <style>
      /* Pastikan modal solid putih */
      .modal-content {
        background-color: #fff !important;
      }
    </style>
  </head>
  <body class="container py-4">
    <!-- Tombol Kembali -->
    <a href="/" class="btn btn-secondary mb-4">
      <i class="fa fa-arrow-left me-1"></i> Kembali ke Dashboard
    </a>

    <!-- ✅ Notifikasi -->
    <% if (query.success) { %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="fa fa-check-circle me-1"></i> Data motif berhasil ditambahkan.
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <% } %> <% if (query.updated) { %>
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
      <i class="fa fa-edit me-1"></i> Data motif berhasil diperbarui.
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <% } %> <% if (query.deleted) { %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="fa fa-trash me-1"></i> Data motif berhasil dihapus.
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <% } %>

    <!-- Form Tambah Motif -->
    <h1 class="mb-4 text-center">Tambahkan Motif</h1>
    <form
      action="/motif/tambah"
      method="POST"
      enctype="multipart/form-data"
      class="mb-5 card card-body shadow-sm"
    >
      <!-- Nama Motif -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Nama Motif</label>
        <input
          type="text"
          name="nama"
          class="form-control"
          placeholder="Masukkan nama motif"
          required
        />
      </div>

      <!-- Deskripsi -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Deskripsi</label>
        <textarea
          name="deskripsi"
          class="form-control"
          rows="4"
          placeholder="Tuliskan deskripsi motif"
          required
        ></textarea>
      </div>

      <!-- Gambar -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Gambar</label>
        <input
          type="file"
          name="gambar"
          class="form-control"
          accept="image/*"
        />
        <small class="text-muted">Format: JPG, PNG, atau JPEG</small>
      </div>

      <!-- Tombol Submit -->
      <button type="submit" class="btn btn-primary w-100">
        <i class="fa fa-plus-circle me-1"></i> Tambah Motif
      </button>
    </form>

    <!-- Daftar Motif -->
    <div class="card shadow-sm border-0 rounded-3">
      <h1 class="mb-3 text-center">Daftar Motif</h1>
      <div class="card-body p-0">
        <table class="table table-bordered table-striped table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th style="width: 15%">Nama</th>
              <th style="width: 45%">Deskripsi</th>
              <th style="width: 20%">Gambar</th>
              <th style="width: 20%">Aksi</th>
            </tr>
          </thead>
          <tbody>
            <% if (data && data.length > 0) { %> <% data.forEach(item => { %>
            <tr>
              <td class="align-middle"><%= item.nama %></td>
              <td class="align-middle"><%= item.deskripsi %></td>
              <td class="align-middle text-center">
                <% if (item.gambar) { %>
                <img
                  src="http://localhost:3000/<%= item.gambar.replace(/^(\/)?/, '') %>"
                  alt="Gambar <%= item.nama %>"
                  class="img-thumbnail"
                  style="max-height: 80px"
                />
                <% } else { %> - <% } %>
              </td>
              <td class="align-middle text-center">
                <!-- Button Edit -->
                <button
                  class="btn btn-warning btn-sm me-1"
                  data-bs-toggle="modal"
                  data-bs-target="#editModal<%= item.id_motif %>"
                >
                  <i class="fa fa-edit"></i> Edit
                </button>

                <!-- Button Hapus -->
                <a
                  href="/motif/hapus/<%= item.id_motif %>"
                  class="btn btn-danger btn-sm"
                  onclick="return confirm('Yakin hapus motif ini?')"
                >
                  <i class="fa fa-trash"></i> Hapus
                </a>
              </td>
            </tr>

            <!-- Modal Edit -->
            <div
              class="modal fade"
              id="editModal<%= item.id_motif %>"
              tabindex="-1"
              aria-labelledby="editModalLabel<%= item.id_motif %>"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-lg">
                <div class="modal-content shadow-sm border-0 rounded-3">
                  <form
                    action="/motif/update/<%= item.id_motif %>"
                    method="POST"
                    enctype="multipart/form-data"
                  >
                    <!-- Header -->
                    <div class="modal-header bg-warning">
                      <h5
                        class="modal-title fw-bold"
                        id="editModalLabel<%= item.id_motif %>"
                      >
                        ✏️ Edit Motif
                      </h5>
                      <button
                        type="button"
                        class="btn-close btn-close-white"
                        data-bs-dismiss="modal"
                      ></button>
                    </div>

                    <!-- Body -->
                    <div class="modal-body">
                      <!-- Nama Motif -->
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Nama Motif</label>
                        <input
                          type="text"
                          name="nama"
                          class="form-control"
                          value="<%= item.nama %>"
                          required
                        />
                      </div>

                      <!-- Deskripsi -->
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Deskripsi</label>
                        <textarea
                          name="deskripsi"
                          class="form-control"
                          rows="4"
                          required
                        >
<%= item.deskripsi %></textarea
                        >
                      </div>

                      <!-- Gambar -->
                      <div class="mb-3">
                        <label class="form-label fw-semibold">Gambar</label>
                        <input
                          type="file"
                          name="gambar"
                          class="form-control"
                          accept="image/*"
                        />
                        <% if (item.gambar) { %>
                        <div class="mt-3">
                          <p class="small text-muted mb-1">
                            Preview gambar saat ini:
                          </p>
                          <img
                            src="http://localhost:3000/<%= item.gambar.replace(/^(\/)?/, '') %>"
                            alt="Preview <%= item.nama %>"
                            class="img-thumbnail rounded"
                            style="max-height: 150px"
                          />
                        </div>
                        <% } %>
                      </div>
                    </div>

                    <!-- Footer -->
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-danger"
                        data-bs-dismiss="modal"
                      >
                        Batal
                      </button>
                      <button type="submit" class="btn btn-warning">
                        <i class="fa fa-save me-1"></i> Simpan Perubahan
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <% }) %> <% } else { %>
            <tr>
              <td colspan="4" class="text-center text-muted">
                Belum ada data motif
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Auto hide alert setelah 3 detik
      setTimeout(() => {
        const alertEl = document.querySelector(".alert");
        if (alertEl) {
          const bsAlert = new bootstrap.Alert(alertEl);
          bsAlert.close();
        }
      }, 3000);
    </script>
  </body>
</html>
