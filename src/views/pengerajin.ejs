<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Data Pengerajin</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <style>
      /* Modal solid putih */
      .modal-content {
        background-color: #fff !important;
      }
    </style>
  </head>
  <body class="container py-4">
    <!-- Tombol Kembali -->
    <a href="/" class="btn btn-secondary mb-4">
      <i class="fa fa-arrow-left me-1"></i> Kembali ke Dashboard
    </a>

    <!-- ✅ Notifikasi -->
    <% if (query.success) { %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="fa fa-check-circle me-1"></i> Data pengerajin berhasil
      ditambahkan.
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <% } %> <% if (query.updated) { %>
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
      <i class="fa fa-edit me-1"></i> Data pengerajin berhasil diperbarui.
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <% } %> <% if (query.deleted) { %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="fa fa-trash me-1"></i> Data pengerajin berhasil dihapus.
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <% } %>

    <!-- Form tambah pengerajin -->
    <h2 class="mb-4 text-center">Tambahkan Pengerajin</h2>
    <form
      action="/pengerajin/tambah"
      method="POST"
      enctype="multipart/form-data"
      class="mb-5 card card-body shadow-sm"
    >
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Nama Toko</label>
          <input
            type="text"
            name="nama_toko"
            class="form-control"
            placeholder="Masukkan Nama Toko"
            required
          />
        </div>

        <div class="col-md-6">
          <label class="form-label">Nama Pemilik</label>
          <input
            type="text"
            name="nama_pemilik"
            class="form-control"
            placeholder="Nama Pemilik"
            required
          />
        </div>

        <div class="col-md-6">
          <label class="form-label">Nomor HP</label>
          <input
            type="text"
            name="nomer_hp"
            class="form-control"
            placeholder="Nomor HP"
            pattern="[0-9]+"
            required
          />
        </div>

        <div class="col-md-6">
          <label class="form-label">Alamat</label>
          <input
            type="text"
            name="alamat"
            class="form-control"
            placeholder="Masukkan Alamat"
            required
          />
        </div>

        <div class="col-12">
          <label class="form-label">Deskripsi</label>
          <textarea
            name="deskripsi"
            class="form-control"
            rows="3"
            placeholder="Masukkan Deskripsi"
            required
          ></textarea>
        </div>

        <div class="col-md-3">
          <label class="form-label">Gambar</label>
          <input
            type="file"
            name="gambar"
            class="form-control"
            accept="image/*"
          />
        </div>

        <div class="col-md-3">
          <label class="form-label">Link Maps</label>
          <input
            type="text"
            name="maps"
            class="form-control"
            placeholder="Masukkan Link Maps"
          />
        </div>

        <div class="col-md-2">
          <label class="form-label">Latitude</label>
          <input
            type="text"
            name="latitude"
            class="form-control"
            placeholder="Latitude"
          />
        </div>

        <div class="col-md-2">
          <label class="form-label">Longitude</label>
          <input
            type="text"
            name="longitude"
            class="form-control"
            placeholder="Longitude"
          />
        </div>

        <div class="col-md-2 d-grid">
          <button class="btn btn-primary mt-4">
            <i class="fa fa-plus-circle me-1"></i> Tambah
          </button>
        </div>
      </div>
    </form>

    <!-- Tabel pengerajin -->
    <h2 class="mb-4 text-center">Daftar Pengerajin</h2>
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Nama Toko</th>
            <th>Nama Pemilik</th>
            <th>Nomor HP</th>
            <th>Deskripsi</th>
            <th>Alamat</th>
            <th>Gambar</th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Maps</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <% if (data && data.length > 0) { %> <% data.forEach((item) => { %>
          <tr>
            <td><%= item.nama_toko %></td>
            <td><%= item.nama_pemilik %></td>
            <td><%= item.nomer_hp %></td>
            <td><%= item.deskripsi %></td>
            <td><%= item.alamat %></td>
            <td>
              <% if (item.gambar) { %>
              <img
                src="<%= item.gambar %>"
                alt="gambar"
                width="80"
                class="img-thumbnail"
              />
              <% } else { %> - <% } %>
            </td>
            <td><%= item.latitude %></td>
            <td><%= item.longitude %></td>
            <td>
              <% if (item.maps) { %>
              <a
                href="<%= item.maps %>"
                target="_blank"
                class="btn btn-sm btn-info"
              >
                Lihat Maps
              </a>
              <% } else { %> - <% } %>
            </td>
            <td>
              <!-- Tombol Update -->
              <button
                class="btn btn-sm btn-warning w-100"
                data-bs-toggle="modal"
                data-bs-target="#editModal<%= item.id_pengerajin %>"
              >
                <i class="fa fa-edit"></i>
                Edit
              </button>

              <!-- Modal Edit -->
              <div
                class="modal fade"
                id="editModal<%= item.id_pengerajin %>"
                tabindex="-1"
                aria-labelledby="editModalLabel<%= item.id_pengerajin %>"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-lg">
                  <div class="modal-content shadow-sm border-0 rounded-3">
                    <form
                      action="/pengerajin/update/<%= item.id_pengerajin %>"
                      method="POST"
                      enctype="multipart/form-data"
                    >
                      <!-- Header -->
                      <div class="modal-header bg-warning">
                        <h5
                          class="modal-title fw-bold"
                          id="editModalLabel<%= item.id_pengerajin %>"
                        >
                          ✏️ Edit Data Pengerajin
                        </h5>
                        <button
                          type="button"
                          class="btn-close btn-close-white"
                          data-bs-dismiss="modal"
                        ></button>
                      </div>

                      <!-- Body -->
                      <div class="modal-body">
                        <div class="row g-3">
                          <div class="col-md-6">
                            <label class="form-label fw-semibold"
                              >Nama Toko</label
                            >
                            <input
                              type="text"
                              name="nama_toko"
                              value="<%= item.nama_toko %>"
                              class="form-control"
                              required
                            />
                          </div>
                          <div class="col-md-6">
                            <label class="form-label fw-semibold"
                              >Nama Pemilik</label
                            >
                            <input
                              type="text"
                              name="nama_pemilik"
                              value="<%= item.nama_pemilik %>"
                              class="form-control"
                              required
                            />
                          </div>
                          <div class="col-md-6">
                            <label class="form-label fw-semibold"
                              >Nomor HP</label
                            >
                            <input
                              type="text"
                              name="nomer_hp"
                              value="<%= item.nomer_hp %>"
                              class="form-control"
                              pattern="[0-9]+"
                              required
                            />
                          </div>
                          <div class="col-md-6">
                            <label class="form-label fw-semibold">Alamat</label>
                            <input
                              type="text"
                              name="alamat"
                              value="<%= item.alamat %>"
                              class="form-control"
                              required
                            />
                          </div>
                          <div class="col-12">
                            <label class="form-label fw-semibold"
                              >Deskripsi</label
                            >
                            <textarea
                              name="deskripsi"
                              class="form-control"
                              rows="3"
                              required
                            >
<%= item.deskripsi %></textarea
                            >
                          </div>
                          <div class="col-md-6">
                            <label class="form-label fw-semibold"
                              >Link Maps</label
                            >
                            <input
                              type="text"
                              name="maps"
                              value="<%= item.maps %>"
                              class="form-control"
                            />
                          </div>
                          <div class="col-md-3">
                            <label class="form-label fw-semibold"
                              >Latitude</label
                            >
                            <input
                              type="text"
                              name="latitude"
                              value="<%= item.latitude %>"
                              class="form-control"
                            />
                          </div>
                          <div class="col-md-3">
                            <label class="form-label fw-semibold"
                              >Longitude</label
                            >
                            <input
                              type="text"
                              name="longitude"
                              value="<%= item.longitude %>"
                              class="form-control"
                            />
                          </div>
                          <div class="col-md-6">
                            <label class="form-label fw-semibold"
                              >Upload Gambar Baru</label
                            >
                            <input
                              type="file"
                              name="gambar"
                              class="form-control"
                              accept="image/*"
                            />
                            <% if (item.gambar) { %>
                            <div class="mt-2">
                              <small class="text-muted d-block"
                                >Gambar saat ini:</small
                              >
                              <img
                                src="<%= item.gambar %>"
                                alt="Gambar <%= item.nama_toko %>"
                                width="100"
                                class="img-thumbnail mt-1"
                              />
                            </div>
                            <% } %>
                          </div>
                        </div>
                      </div>

                      <!-- Footer -->
                      <div class="modal-footer">
                        <button type="submit" class="btn btn-warning">
                          <i class="fa fa-save me-1"></i> Simpan
                        </button>
                        <button
                          type="button"
                          class="btn btn-danger"
                          data-bs-dismiss="modal"
                        >
                          <i class="fa fa-times me-1"></i> Batal
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <!-- Tombol hapus -->
              <a
                href="/pengerajin/hapus/<%= item.id_pengerajin %>"
                class="btn btn-sm btn-danger w-100 mt-1"
                onclick="return confirm('Yakin ingin hapus pengerajin ini?')"
              >
                <i class="fa fa-trash"></i>
                Hapus
              </a>
            </td>
          </tr>
          <% }); %> <% } else { %>
          <tr>
            <td colspan="10">Belum ada pengerajin</td>
          </tr>
          <% } %>
        </tbody>
      </table>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Auto hide alert setelah 3 detik
      setTimeout(() => {
        const alertEl = document.querySelector(".alert");
        if (alertEl) {
          const bsAlert = new bootstrap.Alert(alertEl);
          bsAlert.close();
        }
      }, 3000);
    </script>
  </body>
</html>
